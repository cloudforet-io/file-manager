server {
  listen 80;

  access_log /dev/stdout main;
  error_log  /dev/stderr warn;

  client_max_body_size 10M;

  location / {
    client_max_body_size 10M;
    proxy_pass http://127.0.0.1:8000/;

    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    # 추가 권장 설정
    proxy_connect_timeout 30s;    # 백엔드 연결 timeout
    proxy_send_timeout    300s;   # 요청 전송 timeout (대용량 파일)
    proxy_read_timeout    300s;   # 응답 대기 timeout (GCS와 일치)
    send_timeout          300s;   # 클라이언트로 응답 전송 timeout

    # 대용량 파일 스트리밍을 위한 버퍼링 설정
    proxy_buffering off;          # 스트리밍 응답을 위해 버퍼링 비활성화
    proxy_request_buffering off;  # 대용량 업로드를 위해 요청 버퍼링 비활성화
  }
}
